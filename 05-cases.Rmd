# 数据分析 {#applications}

<!-- 为什么要做这个数据分析，数据要介绍清楚，模型的各个部分要介绍清楚， MCML/PrevMap  ML/Low-Rank 比较 -->
<!-- 在实际数据情况下，哪个模型好，另一方面介绍，模型结论是什么，什么对流行度/感染程度 影响大，哪个影响小，变量影响程度可以用 P值是否显著来表达， -->

loaloa 和 rongelap 两个真实数据集分别来自 R 包 **PrevMap** 和 **geoRglm**， 分别被 Diggle 和 Christensen 分析过 [@Christensen2004;@Diggle2007ATMP]，第 \@ref(loaloa) 节和第 \@ref(rongelap) 节给出分析这两个数据集的模型和结果。其中，响应变量服从二项分布的空间广义线性混合效应模型（简称 Binomial-SGLMM 模型）拟合数据集 loaloa， 而响应变量服从泊松分布的空间广义线性混合效应模型（简称 Poisson-SGLMM 模型）拟合数据集 rongelap。

## 喀麦隆及周边地区盘尾丝虫病的空间分布 {#loaloa}

盘尾丝虫病是由一种可致盲的热带疾病，非洲盘尾丝虫病控制项目 APOC (African Programme for Onchocerciasis Control) 搜集了 $N=168$ 个村庄的 $M = 21938$ 个血液样本，每个村庄抽取的样本量为 $m_i=\mathrm{NO\_EXAM}$， 其中感染了的 NO_INF 人， 在该村庄 （坐标 $x_i$）观察到的感染比例 $p(x_i) = \mathrm{NO\_INF/NO\_EXAM}$ ， 在村庄 1 公里的范围内添加了周围环境的指标， 有从美国地质调查局获得的海拔信息 ELEVATION (<https://www.usgs.gov/>) 和卫星在 1999 年至 2001 年间测得的植被绿色度数据 NDVI (<http://free.vgt.vito.be>)， NDVI 分四个指标， 分别是所有 NDVI 的平均值 MEAN9901，最大值 MAX9901，最小值 MIN9901，标准差 STDEV9901。 样本采集的区域如图 \@ref(fig:loaloa-map) 所示

```{r loaloa-map,echo=FALSE,out.width="90%",fig.asp=1,fig.cap="红色加号标注样本所在的村庄"}
knitr::include_graphics(path = "figures/map-loaloa.png")
```

\noindent 为了分析 loaloa 数据集，我们建立响应变量 $Y$ 服从二项分布的空间广义线性混合效应模型

\begin{equation*}
\begin{split}
\log\big\{ \frac{ p(x_i)}{ 1-p(x_i)} \big\} = 
               & \beta_{0} + \beta_{1} \times \mathrm{ELEVATION}_{i} + \beta_{2} \times \mathrm{MEAN9901}_{i} + \beta_{3} \times \mathrm{MAX9901}_{i} + \\
               & \beta_{4} \times \mathrm{MIN9901}_{i} +  \beta_{5} \times \mathrm{STDEV9901}_{i} + S(x_{i})
\end{split}
\end{equation*}

\noindent 其中，$\beta_0$ 是截距，$\beta_{1},\beta_{2}, \beta_{3},\beta_{4}, \beta_{5}$ 是各指标的系数，$Y_{i} \sim \mathrm{Binomial}(m_{i},p(x_i))$，平稳空间高斯过程 $\mathcal{S} = S(x), x = ( \mathrm{LONGITUDE}, \mathrm{LATITUDE}) \in \mathbb{R}^2$ 的均值为 0，自协方差函数为

\[
\mathrm{Cov}(S(x_i),S(x_j)) = \sigma^2 \big\{2^{\kappa-1}\Gamma(\kappa)\big\}^{-1}(u_{ij}/\phi)^{\kappa}K_{\kappa}(u_{ij}/\phi), \kappa = 2
\] 

在实际数据分析中，选择一组合适的初始值可以缩短各算法迭代的过程。我们分两步获取 $\beta = (\beta_{0},\beta_{1},\beta_{2}, \beta_{3},\beta_{4}, \beta_{5})$和 $\boldsymbol{\theta} = (\sigma^2,\phi)$的初始值。第一步，离散自协方差函数中的$\kappa$，再调用PrevMap包中的`shape.matern`函数选择一个$\kappa$；第二步，在去掉空间效应$S(x)$的情况下，以广义线性模型拟合数据得到$\beta$的初始估计值。然后分别使用贝叶斯MCMC算法和贝叶斯STAN-MCMC算法估计参数 $\beta = (\beta_{0},\beta_{1},\beta_{2}, \beta_{3},\beta_{4}, \beta_{5})$和 $\boldsymbol{\theta} = (\sigma^2,\phi)$，结果如表 \@ref(tab:loaloa-estimation2) 和表 \@ref(tab:loaloa-estimation3)所示。

<!-- Table: (\#tab:loaloa-estimation1) MCML算法估计模型的参数 -->

<!-- | 参数        | 估计        | 标准差      |   标准误    | -->
<!-- | :---------: | :--------:  | :---------: | :------:    | -->
<!-- | $\beta_{0}$ | -11.120     | 1.447       | 8.268e-03   | -->
<!-- | $\beta_{1}$ | -0.001      | 3.155e-04   | 1.023e-05   | -->
<!-- | $\beta_{2}$ | 13.513      | 2.223       | 4.877e-02   | -->
<!-- | $\beta_{3}$ | 1.454       | 2.013       | 3.094e-02   | -->
<!-- | $\beta_{4}$ | -0.576      | 1.315       | 1.016e-02   | -->
<!-- | $\beta_{5}$ | 11.216      | 5.181       | 5.321e-02   | -->
<!-- | $\sigma^2$  | 1.171       | 0.272       | 1.300e-03   | -->
<!-- | $\phi$      | 0.486       | 0.353       | 2.344e-03   | -->

<!-- 通过表\@ref(tab:loaloa-estimation1) 的P值，可以看出 $\beta_{0},\beta_{1},\beta_{2}$ 是显著的，分别对应模型的截距项，海拔(ELEVATION)和 NDVI的平均值(MEAN9901)，在这组数据中，刻画NDVI指标使用平均值比较能体现村庄周围植被的整体绿色度，而最大值MAX9901，最小值MIN9901，标准差STDEV9901与影响不显著。 -->

Table: (\#tab:loaloa-estimation2) 贝叶斯 MCMC 算法估计模型的参数

| 参数        | 估计        | 标准差      |   均方误差  |
| :---------: | :--------:  | :---------: | :------:    |
| $\beta_{0}$ | -11.562     | 0.681       | 5.563e-03   |
| $\beta_{1}$ | -8.721e-04  | 1.415e-04   | 1.155e-06   |
| $\beta_{2}$ | 8.426       | 2.064       | 1.686e-02   |
| $\beta_{3}$ | 4.857       | 1.334       | 1.090e-02   |
| $\beta_{4}$ | 0.233       | 1.367       | 1.116e-02   |
| $\beta_{5}$ | 11.087      | 3.565       | 2.911e-02   |
| $\sigma^2$  | 1.096       | 0.170       | 1.390e-03   |
| $\phi$      | 3.675       | 0.582       | 4.754e-03   |

Table: (\#tab:loaloa-estimation3) 贝叶斯 STAN-MCMC 算法估计模型的参数

| 参数        | 估计        | 标准差      |   均方误差  |
| :---------: | :--------:  | :---------: | :------:    |
| $\beta_{0}$ | -12.878     | 1.460       | 3.515e-03   |
| $\beta_{1}$ | -6.596e-04  | 3.188e-04   | 7.733e-07   |
| $\beta_{2}$ | 9.647       | 2.136       | 5.222e-03   |
| $\beta_{3}$ | 4.380       | 1.993       | 5.026e-03   |
| $\beta_{4}$ | -0.102      | 1.159       | 2.822e-03   |
| $\beta_{5}$ | 11.216      | 5.539       | 1.343e-02   |
| $\sigma^2$  | 1.027       | 0.09        | 2.171e-04   |
| $\phi$      | 1.157e-02   | 1.292e-03   | 3.244e-06   |

比较表 \@ref(tab:loaloa-estimation2) 和表 \@ref(tab:loaloa-estimation3)， 发现贝叶斯 STAN-MCMC 算法比贝叶斯 MCMC 算法稍好一点， 多半的参数估计的标准差要小一些， 均方误差普遍要小一点。

<!-- % latex table generated in R 3.5.0 by xtable 1.8-2 package -->
<!-- % Mon Jun 18 19:53:37 2018 -->
<!-- \begin{longtable}{lrrr} -->
<!--   \toprule -->
<!-- Parameter & mean & sd & se\_mean \\  -->
<!--   \midrule -->
<!-- b\_intercept & -12.8784 & 1.4601 & 0.0429 \\  -->
<!--   b\_ELEVATION & -0.0007 & 0.0003 & 0.0000 \\  -->
<!--   b\_MEAN9901 & 9.6479 & 2.1367 & 0.0687 \\  -->
<!--   b\_MAX9901 & 4.3801 & 1.9929 & 0.0564 \\  -->
<!--   b\_MIN9901 & -0.1018 & 1.1595 & 0.0327 \\  -->
<!--   b\_STDEV9901 & 17.7825 & 5.5394 & 0.1734 \\  -->
<!--   sdgp\_gpLONGITUDELATITUDE & 1.0274 & 0.0881 & 0.0027 \\  -->
<!--   lscale\_gpLONGITUDELATITUDE & 0.0116 & 0.0013 & 0.0000 \\  -->
<!--    \bottomrule -->
<!-- \end{longtable} -->

## 朗格拉普岛放射性残留物的空间分布 {#rongelap}

RgoogleMaps [@Loecher2015] 获取卫星图像

朗格拉普岛位于南太平洋上，是马绍尔群岛的一部分，二战后，美国在该岛上进行了核武器测试，核爆炸后产生的放射性尘埃笼罩了全岛，目前该岛仍然不适合人类居住，只有经批准的科学研究人员才能登岛，核污染残留浓度是其中一项 [@Bordner2016]。rongelap 数据集包含伽马射线在 $N=157$ 站点不同时间间隔的放射量。

```{r rongelap-dataset,fig.cap="朗格拉普岛上采样点的位置，加号 + 表示采样的位置"}
knitr::include_graphics(path = "figures/rongelap.png")
```

伽马射线在时间 units.m 内放射的粒子数目为 y，d1 和 d2 分别为测量坐标。 类似第 \@ref(loaloa)节，首先建立 Poisson-SGLMM 模型 

\begin{equation}
\log\{\lambda(x_{i})\} =  \beta_{0} + S(x_{i}) (\#eq:rongelap-without-nugget-effect)
\end{equation}

其中，$\beta_0$ 是截距， 响应变量 $Y_{i} \sim \mathrm{Poisson}(\lambda(x_i))$， 我们同样使用贝叶斯 MCMC 算法和 STAN-MCMC 算法计算 Poisson-SGLMM 模型的参数，比较效果。

<!-- Table: (\#tab:rongelap-estimation1) MCML算法估计模型的参数 -->

<!-- | 参数        | 估计        | 标准差      |   P 值      | -->
<!-- | :---------: | :--------:  | :---------: | :------:    | -->
<!-- | $\beta_{0}$ |  7.641      | 0.172       | 1.582e-14   | -->
<!-- | $\sigma^2$  | 0.295       | 0.643       | -           | -->
<!-- | $\phi$      | 103.075     | 1.812e+44   | -           | -->

Table: (\#tab:rongelap-estimation2) 贝叶斯 MCMC 算法估计模型的参数

| 参数        | 估计        | 标准差      |   均方误差  |
| :---------: | :--------:  | :---------: | :------:    |
| $\beta_{0}$ | 7.988       | 0.062       | 5.095e-03   |
| $\sigma^2$  | 0.380       | 0.048       | 3.926e-03   |
| $\phi$      | 16.440      | 7.828       | 6.391e-02   |

Table: (\#tab:rongelap-estimation3) 贝叶斯STAN-MCMC算法估计模型的参数

| 参数        | 估计        | 标准差      |   均方误差  |
| :---------: | :--------:  | :---------: | :------:    |
| $\beta_{0}$ | 8.697       | 0.028       | 5.563e-03   |
| $\sigma^2$  | 0.812       | 0.017       | 1.390e-03   |
| $\phi$      | 10.893      | 5.302       | 4.754e-02   |

比较表 \@ref(tab:rongelap-estimation2) 和表 \@ref(tab:rongelap-estimation3)，发现贝叶斯 STAN-MCMC 算法与贝叶斯 MCMC 算法相比，在均方误差的意义下效果稍好一点。

Table: (\#tab:rongelap-without-nugget-effect) 不带块金效应的模型 \@ref(eq:rongelap-without-nugget-effect) 参数估计和 95\% 的置信区间

| 参数            |   2.5\%分位点   |   97.5\%分位点  |   均值 (mean)  |  中位数 (median)  |
| :-------------- | :-------------: | :-------------: | :------------: | :---------------: |
| $\beta_0$       |    1.674000     |     1.989000    |    1.830112    |   -0.077961       |
| $\sigma$        |    0.488595     |     0.594607    |    0.539014    |   -0.077961       |


## 冈比亚儿童疟疾流行强度的空间分布

[MCMC 和 INLA 比较]{.todo}

5 岁以下儿童 在非洲冈比亚的 65 个村庄里调查疟疾感染情况， 依冈比亚狭长的地带和横穿东西全境的冈比亚河， 将其看作东、中和西三个部分， 东部是河流上游，西部是河流下游相应地，村庄分为 5 个区域，西部两个， 南岸和北岸各一个，中游一个在南岸，东部两个，也是南岸和北岸各有一个， 村庄的位置在图中的黑点标记。

```{r childhood-malaria,fig.cap="冈比亚 65 个村庄的空间位置，黑点标记，插入的图是响应区域的放大版，由箭头指向"}
knitr::include_graphics(path = "figures/gambia-map.png")
```

\begin{equation}
\log\{p_{ij}/(1-p_{ij})\} = \alpha + \beta^{\top}z_{ij} + S(x_i) (\#eq:gambia-without-nugget-effect)
\end{equation}

Table: (\#tab:gambia-without-nugget-effect) 不带块金效应的模型 \@ref(eq:gambia-without-nugget-effect) 参数估计和 95\% 的置信区间

| 参数                  |   2.5\%分位点   |   97.5\%分位点  |   均值 (mean)  |  中位数 (median)  |
| :-------------------- | :-------------: | :-------------: | :------------: | :---------------: |
| $\alpha$              |    -2.966473    |     2.624348    |   -0.131214    |   -0.077961       |
| $\beta_1$(age)        |     0.000455    |     0.000933    |    0.000689    |    0.000685       |
| $\beta_2$(untreated)  |    -0.673143    |    -0.042011    |   -0.357825    |   -0.359426       |
| $\beta_3$(treated)    |    -0.753803    |     0.088418    |   -0.32954     |   -0.325853       |
| $\beta_4$(greenness)  |    -0.085675    |     0.047924    |   -0.020068    |   -0.020834       |
| $\beta_5$(PHC)        |    -0.787913    |     0.129883    |   -0.344846    |   -0.349915       |
| $\beta_6$(area 2)     |    -1.14419     |     0.51023     |   -0.324665    |   -0.331634       |
| $\beta_7$(area 3)     |    -1.40862     |     0.558616    |   -0.5321      |   -0.559229       |
| $\beta_8$(area 4)     |    -0.109472    |     2.425342    |    1.049441    |    1.016969       |
| $\beta_9$(area 5)     |     0.164828    |     2.606357    |    1.309553    |    1.325129       |
| $\sigma^2$            |     0.311756    |     1.050227    |    0.585592    |    0.553477       |
| $\phi$                |     0.915789    |     10.20069    |    2.522294    |    1.422975       |
| $\kappa$              |     0.079522    |     2.784646    |    1.084108    |    0.937436       |

表 \@ref(tab:gambia-without-nugget-effect) 来自 Peter Diggle 等 (2002) [@Diggle2002Childhood] 的结果

\begin{equation}
\log\{p_{ij}/(1-p_{ij})\} = \alpha + \beta^{\top}z_{ij} + U_{i} + S(x_i) (\#eq:gambia-with-nugget-effect)
\end{equation}

Table: (\#tab:gambia-with-nugget-effect) 带块金效应的模型 \@ref(eq:gambia-with-nugget-effect) 参数估计和 95\% 的置信区间

| 参数                  |   2.5\%分位点   |   97.5\%分位点  |   均值 (mean)  |  中位数 (median)  |
| :-------------------- | :-------------: | :-------------: | :------------: | :---------------: |
| $\alpha$              |    -4.232073    |     1.114734    |   -1.664353    |   -1.696228       |
| $\beta_1$(age)        |     0.000442    |     0.000918    |    0.000677    |    0.000676       |
| $\beta_2$(untreated)  |    -0.684407    |    -0.083811    |   -0.383750    |   -0.385772       |
| $\beta_3$(treated)    |    -0.778149    |     0.054543    |   -0.355655    |   -0.355632       |
| $\beta_4$(greenness)  |    -0.039706    |     0.071505    |   -0.018833    |    0.020079       |
| $\beta_5$(PHC)        |    -0.791741    |     0.180737    |   -0.324738    |   -0.322760       |
| $\nu^2$               |     0.000002    |     0.515847    |    0.117876    |    0.018630       |
| $\sigma^2$            |     0.240826    |     1.662284    |    0.793031    |    0.740790       |
| $\phi$                |     1.242164    |     53.351207   |   11.653717    |    7.032258       |
| $\kappa$              |     0.150735    |     1.955524    |    0.935064    |    0.830548       |

将投影坐标系 (UTM) 转化为地理坐标系 (WGS84)





